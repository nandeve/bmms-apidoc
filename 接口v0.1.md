# 接口文档 v0.1

## 用户角色说明

系统中共有两种用户：管理员用户，普通用户

`isAdmin`字段为`1`表示管理员用户，`0`表示普通用户

## 请求数据说明

- 必选的请求数据表示用户必须填写，发起请求时都需校验
- 非必选的请求数据表示用户可以不填写，有默认值的需前端手动设置默认值
- 请求数据一般存放在2处
  1. 在URL路径中
  2. 在请求体body中

## 返回数据说明

返回数据统一格式如下

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   | 实际需要在页面上渲染的数据                          |

请求成功返回数据示例

> 对于不需要返回数据的请求，都会返回此格式

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

若浏览器内部发生了异常，则会统一返回如下数据

```json
{
    "code": 99999,
    "msg": "服务器故障，请稍后重试",
    "data": null
}
```

## 返回cookie说明

- 登录成功后会返回如下cookie信息，浏览器在cookie有效期内会自动保存这些数据，每次发起请求都会携带这些数据
- 登出之后所有cookie的值都会被清空
- 前端在发起需要登录才能访问的接口时需要判断是否已登录
- 在发起需要管理员权限才能访问的接口时需要判断是否是管理员

| cookie参数 | 说明           | 类型   | 备注                                      |
| :--------- | -------------- | :----- | :---------------------------------------- |
| isLogin    | 是否登录       | int    | 1表示当前处于登录状态，没有值则表示已登出 |
| userId     | 用户id         | string |                                           |
| account    | 用户账号       | string |                                           |
| username   | 用户名         | string |                                           |
| isAdmin    | 是否管理员用户 | int    | 1表示管理员用户，0表示普通用户            |
| token      | 请求令牌       | string | 加密令牌                                  |

## 前端原型草稿

登录页

![image-20220207170930314](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081714079.png)

主页

![image-20220207171020801](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081714180.png)

图书列表

![image-20220207171102052](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081714314.png)

图书分类管理

![image-20220207171125826](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081714333.png)

## 1 用户接口

### 1.1 登录

#### 接口说明

**接口功能**

> 用户登录
>
> - 登录成功后会返回cookie，浏览器会自动保存，以后对于该项目的每次请求都会自动携带cookie

**API**

> /user/login

**请求方法**

> POST

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数  | 说明        | 必选 | 类型   | 默认值 | 限制                       | 备注                                |
| :-------- | ----------- | :--- | ------ | :----- | -------------------------- | ----------------------------------- |
| account   | 账号        | 是   | string |        | 长度6~16，仅支持字母或数字 |                                     |
| password  | 密码        | 是   | string |        | 长度6-16，仅支持字母或数字 | 发起请求时，需转换为md5加密32位小写 |
| keep7Days | 7天保持登录 |      | bool   | false  |                            | 为true则保留7天登录状态             |

**返回参数格式**

> JSON

**返回参数说明**

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   |                                                     |

**返回cookie说明**

| cookie参数 | 说明           | 类型   | 备注                                      |
| :--------- | -------------- | :----- | :---------------------------------------- |
| isLogin    | 是否登录       | int    | 1表示当前处于登录状态，没有值则表示已登出 |
| userId     | 用户id         | string |                                           |
| account    | 用户账号       | string |                                           |
| username   | 用户名         | string |                                           |
| isAdmin    | 是否管理员用户 | int    | 1表示管理员用户，0表示普通用户            |
| token      | 请求令牌       | string | 加密令牌                                  |

#### 示例

##### 登录成功

请求地址

> /user/login

**请求参数**

``` json
{
    "account": "1320219000",
    "password": "504ea9b3323755d8bbca6087e8de492a",
    "keep7Days": true
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

返回cookie

![image-20220206231458649](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202062314769.png)

##### 登录参数不合法

请求地址

> /user/login

请求参数

``` json
{
    "account": "",
    "password": "504ea9b3323755d8bbca6087e8de492a",
    "keep7Days": true
}
```

返回参数

```json
{
    "code": 40001,
    "msg": "登录参数不合法",
    "data": null
}
```

说明

> - 前端在发起请求前，必须要校验用户名和密码是否符合限制条件
> - 后端在收到请求后，也必须要校验用户名和密码是否符合合法

##### 账号或密码错误

请求地址

> /user/login

请求参数

``` json
{
    "account": "132021900",
    "password": "504ea9b3323755d8bbca6087e8de492a",
    "keep7Days": true
}
```

返回参数

```json
{
    "code": 40002,
    "msg": "账号或密码错误",
    "data": null
}
```

### 1.2 登出

#### 接口说明

**接口功能**

> 退出当前用户的登录状态
>
> - 登出成功后cookie会被清空

**API**

> /user/logout

**请求方法**

> GET

**请求参数说明**

> 请求不需要额外携带参数
>
> - 若当前处于登录状态，则会自动携带cookie数据，登出成功后cookie会被清空
> - 若当前未处于登录状态并请求此接口，会返回`99999`服务器异常

**返回参数格式**

> JSON

**返回参数说明**

> - 成功返回200
> - 失败返回99999

#### 示例

##### 登出成功

成功登出后浏览器cookie会被清空

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

##### 登出失败

```json
{
    "code": 99999,
    "msg": "服务器故障，请稍后重试",
    "data": null
}
```

## 2 图书管理接口

### 2.1 查询图书

#### 接口说明

**接口功能**

> 分页按条件查询所有图书
>
> - 该接口必须携带分页数据，条件可为空
>
> - 分页使用mybatis-plus分页插件，直接将查询结果赋值给Result对象的data属性返回即可，返回的数据中包含了前端需要的数据以及一些不需要的数据，全部直接返回即可
> - 分页查询时按name字段升序排序（order by name asc），name字段在数据库中使用的字符集为gbk中文字符，升序会按照先英文后中文按拼音顺序升序排列
> - 若当前页数大于总页数，则返回最后一页的数据
> - 按条件查询共有5个条件，具体看下面请求参数说明
> - 查询匹配条件时使用mybatis-plus的LambdaQueryWrapper，使用模糊查询（like）即可，如果某个查询条件为空则不需要添加此条件

**API**

> /book/:curPage/:pageSize?name=&description=&location=&category=&organization=

**请求方法**

> GET

**请求参数格式**

> URL路径变量
>
> - `:curPage`和`:pageSize`使用数字替换
> - `name`、`description`、`location`、`category`、`organization`如果没有输入条件则等号后面为空，如果输入了查询条件则拼接在每个条件的等号后

**请求参数说明**

| 请求参数     | 说明           | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :----------- | -------------- | :--- | ------ | :----- | ---- | ---- |
| curPage      | 当前页数       | 是   | int    | 1      | > 0  |      |
| pageSize     | 每页的数据条数 | 是   | int    | 5      |      |      |
| name         | 名称           |      | string |        |      |      |
| description  | 描述           |      | string |        |      |      |
| location     | 位置           |      | string |        |      |      |
| category     | 分类           |      | string |        |      |      |
| organization | 组织           |      | string |        |      |      |

**返回参数格式**

> JSON

**返回参数说明**

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   | 数据，一个json对象                                  |

**data数据说明**

| 参数    | 说明                   | 类型 | 备注     |
| :------ | ---------------------- | :--- | :------- |
| total   | 查询到的全部数据的条数 | int  |          |
| size    | 每页的数据条数         | int  |          |
| current | 当前的页数             | int  |          |
| pages   | 查询到的全部数据的页数 | int  |          |
| records | 当前页的数据           | json | json数组 |

**records数据说明**

| 参数         | 说明           | 类型   | 备注 |
| :----------- | -------------- | :----- | :--- |
| id           | 图书id         | int    |      |
| name         | 名称           | string |      |
| number       | 总数量         | int    |      |
| stockNum     | 当前库存的数量 | int    |      |
| description  | 描述           | string |      |
| imageUrl     | 图片链接       | string |      |
| location     | 位置           | string |      |
| category     | 分类           | string |      |
| organization | 组织           | string |      |

#### 接口示例

##### 无条件分页查询所有图书第1页

请求地址

> /book/1/5?name=&description=&location=&category=&organization=

返回数据

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 6,
        "size": 5,
        "current": 1,
        "pages": 2,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 3,
                "stockNum": 3,
                "description": "谭浩强出品",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/9099800/1aa13aac43be0394_n.jpg",
                "location": "一层",
                "category": "计算机",
                "organization": "北京书院"
            },
            {
                "id": 2,
                "name": "高等数学",
                "number": 2,
                "stockNum": 0,
                "description": "同济大学出版",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/12432791/4151accc2db4b093_n.jpg",
                "location": "二层",
                "category": "数学",
                "organization": "北京书院"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 4,
                "stockNum": 3,
                "description": "北理工教学专用",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/6743940/49b582d424419c1f_n.jpg",
                "location": "三层",
                "category": "物理",
                "organization": "北京书院学生会"
            },
            {
                "id": 4,
                "name": "C++ Prime Plus",
                "number": 5,
                "stockNum": 2,
                "description": "c++从入门到入土",
                "imageUrl": "https://www.kfzimg.com/sw/kfzimg/1773/015a4ade52edf6cfb3_n.jpg",
                "location": "一层",
                "category": "计算机",
                "organization": "北京书院学生会"
            },
            {
                "id": 5,
                "name": "线性代数",
                "number": 6,
                "stockNum": 6,
                "description": "同济大学出版",
                "imageUrl": "https://www.kfzimg.com/G06/M00/D0/24/p4YBAFqYqJKAWb3GAACFCmcJuCQ703_n.jpg",
                "location": "二层",
                "category": "数学",
                "organization": "北京书院"
            }
        ]
    }
}
```

##### 无条件分页查询所有图书第2页

> 目前只有2页的数据，若查询页数大于总页数则返回最后一页的数据

请求地址

> /book/2/5?name=&description=&location=&category=&organization=

返回数据

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 6,
        "size": 5,
        "current": 2,
        "pages": 2,
        "records": [
            {
                "id": 6,
                "name": "简明量子力学",
                "number": 4,
                "stockNum": 4,
                "description": "北京大学出版",
                "imageUrl": "https://www.kfzimg.com/sw/kfzimg/1838/016847d79e9ca38fac_n.jpg",
                "location": "三层",
                "category": "物理",
                "organization": "北京书院学生会"
            }
        ]
    }
}
```

##### 按name条件分页查询

> 查询名称中有`学`字的图书，即`name=学`

请求地址

> /book/1/5?name=学&description=&location=&category=&organization=

返回数据

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 3,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 2,
                "name": "高等数学",
                "number": 2,
                "stockNum": 0,
                "description": "同济大学出版",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/12432791/4151accc2db4b093_n.jpg",
                "location": "二层",
                "category": "数学",
                "organization": "北京书院"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 4,
                "stockNum": 3,
                "description": "北理工教学专用",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/6743940/49b582d424419c1f_n.jpg",
                "location": "三层",
                "category": "物理",
                "organization": "北京书院学生会"
            },
            {
                "id": 6,
                "name": "简明量子力学",
                "number": 4,
                "stockNum": 4,
                "description": "北京大学出版",
                "imageUrl": "https://www.kfzimg.com/sw/kfzimg/1838/016847d79e9ca38fac_n.jpg",
                "location": "三层",
                "category": "物理",
                "organization": "北京书院学生会"
            }
        ]
    }
}
```

##### 按category添加分页查询

> 查询分类为`计算机`的图书，即`category=计算机`

请求地址

> /book/1/5?name=&description=&location=&category=计算机&organization=

返回数据

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 3,
                "stockNum": 3,
                "description": "谭浩强出品",
                "imageUrl": "https://www.kfzimg.com/sw/kfz-cos/kfzimg/9099800/1aa13aac43be0394_n.jpg",
                "location": "一层",
                "category": "计算机",
                "organization": "北京书院"
            },
            {
                "id": 4,
                "name": "C++ Prime Plus",
                "number": 5,
                "stockNum": 2,
                "description": "c++从入门到入土",
                "imageUrl": "https://www.kfzimg.com/sw/kfzimg/1773/015a4ade52edf6cfb3_n.jpg",
                "location": "一层",
                "category": "计算机",
                "organization": "北京书院学生会"
            }
        ]
    }
}
```

### 2.2 更新图书

#### 接口说明

**接口功能**

> 更新某本书的信息

**API**

> /book

**请求方法**

> PUT

**请求参数格式**

> JSON

**请求参数说明**

> 参数在请求体body中

| 请求参数     | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注                             |
| :----------- | -------- | :--- | ------ | :----- | ---- | -------------------------------- |
| id           | 图书id   | 是   | int    |        |      | 该项不可修改                     |
| name         | 名称     | 是   | string |        |      |                                  |
| number       | 总数量   | 是   | int    |        |      |                                  |
| stockNum     | 当前库存 | 是   | int    |        |      |                                  |
| description  | 描述     | 是   | string |        |      |                                  |
| location     | 位置     | 是   | string |        |      |                                  |
| category     | 分类     | 是   | string |        |      | 分类只能选择分类表中已存储的分类 |
| organization | 组织     | 是   | string |        |      | 组织只能选择组织表中已存储的组织 |

**返回参数格式**

> JSON

#### 示例

##### 修改图书名称

> 将`线性代数`修改为`线性代数教程`

请求地址

> /book


请求参数

``` json
{
    "id": 5,
    "name": "线性代数教程",
    "number": 6,
    "stockNum": 6,
    "description": "同济大学出版",
    "location": "二层",
    "category": "数学",
    "organization": "北京书院"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 2.3 删除图书

#### 接口说明

**接口功能**

> 删除图书

**API**

> /book/:id

**请求方法**

> DELETE

**请求参数格式**

> URL路径变量

**请求参数说明**

> `id`为需要删除的图书id

**返回参数格式**

> JSON

#### 接口示例

##### 删除id为4的图书

请求地址

> /book/4

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 3 图书入库接口

### 3.1 按时间段分页查询入库记录

#### 接口说明

**接口功能**

> 按时间段分页查询入库记录
>
> - 分页数据必须携带
> - 时间格式为`yyyy-MM-dd`，只精确到天

**API**

> /bookEntry/:curPage/:pageSize?startTime=&endTime=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数  | 说明         | 必选 | 类型     | 限制             | 备注                                           |
| :-------- | ------------ | :--- | -------- | ---------------- | ---------------------------------------------- |
| curPage   | 当前页       | 是   | int      |                  |                                                |
| pageSize  | 每页的数据量 | 是   | int      |                  |                                                |
| startTime | 开始时间     |      | datetime | 格式`yyyy-MM-dd` | 前端未携带开始时间则后端手动设置为`1900-01-01` |
| endTime   | 结束时间     |      | datetime | 格式`yyyy-MM-dd` | 前端未携带结束时间则后端手动设置为`2099-12-31` |

**返回参数格式**

> JSON

**返回参数说明**

> 备注：分页查询具体的返回参数结构参考`2.1 查询图书`，以下参数说明为`records`数组中每一个对象的参数

| 返回参数    | 说明       | 类型     | 备注 |
| :---------- | ---------- | :------- | :--- |
| id          | 入库记录id | int      |      |
| name        | 图书名称   | string   |      |
| number      | 入库数量   | int      |      |
| create_time | 入库时间   | datetime |      |

#### 接口示例

##### 不按时间段分页查询所有入库记录第1页

请求地址

> /bookEntry/1/5?startTime=&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 9,
        "size": 5,
        "current": 1,
        "pages": 2,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 1,
                "create_time": "2022-01-23 15:19:39"
            },
            {
                "id": 2,
                "name": "高等数学",
                "number": 1,
                "create_time": "2022-01-23 15:22:18"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 1,
                "create_time": "2022-01-23 15:27:02"
            },
            {
                "id": 4,
                "name": "C语言程序设计",
                "number": 2,
                "create_time": "2022-01-23 15:27:24"
            },
            {
                "id": 5,
                "name": "高等数学",
                "number": 1,
                "create_time": "2022-02-23 15:27:39"
            }
        ]
    }
}
```

##### 不按时间段分页查询所有入库记录第2页

请求地址

> /bookEntry/2/5?startTime=&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 9,
        "size": 5,
        "current": 2,
        "pages": 2,
        "records": [
            {
                "id": 6,
                "name": "大学物理",
                "number": 3,
                "create_time": "2022-02-23 15:27:54"
            },
            {
                "id": 7,
                "name": "C++ Prime Plus",
                "number": 5,
                "create_time": "2022-02-23 15:30:32"
            },
            {
                "id": 8,
                "name": "线性代数教程",
                "number": 6,
                "create_time": "2022-02-23 15:32:24"
            },
            {
                "id": 9,
                "name": "简明量子力学",
                "number": 4,
                "create_time": "2022-02-23 15:35:00"
            }            
        ]
    }
}
```

##### 指定开始时间分页查询入库记录

请求地址

> /bookEntry/1/5?startTime=2022-02-01&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 5,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 5,
                "name": "高等数学",
                "number": 1,
                "create_time": "2022-02-23 15:27:39"
            },
            {
                "id": 6,
                "name": "大学物理",
                "number": 3,
                "create_time": "2022-02-23 15:27:54"
            },
            {
                "id": 7,
                "name": "C++ Prime Plus",
                "number": 5,
                "create_time": "2022-02-23 15:30:32"
            },
            {
                "id": 8,
                "name": "线性代数教程",
                "number": 6,
                "create_time": "2022-02-23 15:32:24"
            },
            {
                "id": 9,
                "name": "简明量子力学",
                "number": 4,
                "create_time": "2022-02-23 15:35:00"
            }            
        ]
    }
}
```

##### 指定结束时间分页查询入库记录

请求地址

> /bookEntry/1/5?startTime=&endTime=2022-02-01

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 4,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 1,
                "create_time": "2022-01-23 15:19:39"
            },
            {
                "id": 2,
                "name": "高等数学",
                "number": 1,
                "create_time": "2022-01-23 15:22:18"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 1,
                "create_time": "2022-01-23 15:27:02"
            },
            {
                "id": 4,
                "name": "C语言程序设计",
                "number": 2,
                "create_time": "2022-01-23 15:27:24"
            }
        ]
    }
}
```

##### 指定开始结束时间分页查询入库记录

请求地址

> /bookEntry/1/5?startTime=2022-01-01&endTime=2022-02-01

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 4,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 1,
                "create_time": "2022-01-23 15:19:39"
            },
            {
                "id": 2,
                "name": "高等数学",
                "number": 1,
                "create_time": "2022-01-23 15:22:18"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 1,
                "create_time": "2022-01-23 15:27:02"
            },
            {
                "id": 4,
                "name": "C语言程序设计",
                "number": 2,
                "create_time": "2022-01-23 15:27:24"
            }
        ]
    }
}
```

### 3.2 添加图书入库

#### 接口说明

**接口功能**

> 添加图书入库
>
> - 此前已在`图书管理接口`部分实现了`添加图书`的接口，与该接口冲突，删除前者（只删除控制层接口，业务层的方法保留可以使用），保留后者

**说明**

> - 此接口需要修改两张表，即`book`表和`book_entry`表
> - 很明显这是一个事务，要么都成功，要么都失败，在`springboot`中使用事务参考`@Transactional`注解
> - 应该先操作`book`表插入图书得到其`id`，再插入记录到`book_entry`表中

**API**

> /bookEntry

**请求方法**

> POST

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数     | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :----------- | -------- | :--- | ------ | :----- | ---- | ---- |
| name         | 图书名称 | 是   | string |        |      |      |
| number       | 数量     | 是   | int    |        |      |      |
| description  | 描述     |      | string |        |      |      |
| location     | 位置     |      | string |        |      |      |
| category     | 分类     |      | string |        |      |      |
| organization | 组织     |      | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /bookEntry


请求参数

``` json
{
    "name": "Python编程",
    "number": 5,
    "description": "Python从入门到入土",
    "location": "一层",
    "category": "计算机",
    "organization": "北京书院"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 3.4 删除入库记录

#### 接口说明

**接口功能**

> 删除某条入库记录

**API**

> /bookEntry/:id

**请求方法**

> DELETE

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明     | 必选 | 类型 | 默认值 | 限制 | 备注 |
| :------- | -------- | :--- | ---- | :----- | ---- | ---- |
| id       | 记录的id | 是   |      |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /bookEntry/9

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 4 图书借还接口

### 4.1 按时间段按条件查询借还记录

#### 接口说明

**接口功能**

> 按时间段按条件查询借还记录
>
> - 关于按时间段查询的说明参考`3.1 按时间段分页查询入库记录`的接口说明和接口示例
> - 按条件分为三种：全部、已还、未还

**API**

> /bookBorrowReturn/:curPage/:pageSize?return=&startTime=&endTime=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数  | 说明       | 必选 | 类型     | 默认值 | 限制 | 备注                                                         |
| :-------- | ---------- | :--- | -------- | :----- | ---- | ------------------------------------------------------------ |
| curPage   | 当前页数   | 是   | int      |        |      |                                                              |
| pageSize  | 总页数     | 是   | int      |        |      |                                                              |
| return    | 是否已归还 |      | int      |        |      | 空表示查询所有，<br />`0`表示查询未归还，<br />`1`表示查询已归还 |
| startTime | 开始时间   |      | datetime |        |      |                                                              |
| endTime   | 借书时间   |      | datetime |        |      |                                                              |

**返回参数格式**

> JSON

**返回参数说明**

> 备注：分页查询具体的返回参数结构参考`2.1 查询图书`，以下参数说明为`records`数组中每一个对象的参数

| 返回参数      | 说明             | 类型     | 备注             |
| :------------ | ---------------- | :------- | :--------------- |
| id            | 记录id           | int      |                  |
| name          | 图书名称         | string   |                  |
| number        | 借阅的数量       | int      |                  |
| student_id    | 借阅的学生的学号 | string   |                  |
| borrow_time   | 借阅时间         | datetime |                  |
| return_time   | 归还时间         | datetime | 为空则表示未归还 |
| operator_name | 操作者的name     | string   |                  |

#### 接口示例

##### 查询所有借还记录

请求地址

> /bookBorrowReturn/1/5?return=&startTime=&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 4,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 1,
                "student_id": "1120219001",
                "borrow_time": "2022-01-23 21:53:36",
                "return_time": "2022-01-23 21:54:01",
                "operator_name": "北京书院学生会"
            },
            {
                "id": 2,
                "name": "高等数学",
                "number": 2,
                "student_id": "1120219002",
                "borrow_time": "2022-01-23 21:54:39",
                "return_time": "",
                "operator_name": "北京书院"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 1,
                "student_id": "1120219003",
                "borrow_time": "2022-01-23 21:55:25",
                "return_time": "",
                "operator_name": "小坦克"
            },
            {
                "id": 4,
                "name": "C++ Prime Plus",
                "number": 3,
                "student_id": "1120219004",
                "borrow_time": "2022-01-23 21:56:25",
                "return_time": "2022-01-23 22:56:59",
                "operator_name": "北京书院学生会"
            }        
        ]
    }
}
```

请求地址

##### 查询已还记录

> /bookBorrowReturn/1/5?return=1&startTime=&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "C语言程序设计",
                "number": 1,
                "student_id": "1120219001",
                "borrow_time": "2022-01-23 21:53:36",
                "return_time": "2022-01-23 21:54:01",
                "operator_name": "北京书院学生会"
            },
            {
                "id": 4,
                "name": "C++ Prime Plus",
                "number": 3,
                "student_id": "1120219004",
                "borrow_time": "2022-01-23 21:56:25",
                "return_time": "2022-01-23 22:56:59",
                "operator_name": "北京书院学生会"
            }        
        ]
    }
}
```

请求地址

##### 查询未还记录

> /bookBorrowReturn/1/5?return=0&startTime=&endTime=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 2,
                "name": "高等数学",
                "number": 2,
                "student_id": "1120219002",
                "borrow_time": "2022-01-23 21:54:39",
                "return_time": "",
                "operator_name": "北京书院"
            },
            {
                "id": 3,
                "name": "大学物理",
                "number": 1,
                "student_id": "1120219003",
                "borrow_time": "2022-01-23 21:55:25",
                "return_time": "",
                "operator_name": "小坦克"
            }     
        ]
    }
}
```

### 4.2 借书

#### 接口说明

**接口功能**

> 借阅某本书

**API**

> /bookBorrowReturn

**请求方法**

> POST

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数  | 说明       | 必选 | 类型   | 默认值 | 限制                 | 备注 |
| :-------- | ---------- | :--- | ------ | :----- | -------------------- | ---- |
| bookId    | 图书id     | 是   | int    |        |                      |      |
| studentId | 借阅者学号 | 是   | string |        |                      |      |
| number    | 数量       | 是   | int    |        | 数量不得超过现有库存 |      |

> 后端接收到数据后需要查询数据库判断数量是否超过现有库存，若超过则返回错误信息

**返回参数格式**

> JSON

#### 接口示例

##### 借书成功

请求地址

> /bookBorrowReturn


请求参数

``` json
{
    "bookId": 5,
    "studentId": "1120219020",
    "number": 3
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

##### 借书失败

请求地址

> /bookBorrowReturn


请求参数

``` json
{
    "bookId": 5,
    "studentId": "1120219020",
    "number": 10
}
```

返回参数

```json
{
    "code": "xxx",
    "msg": "库存不足",
    "data": null
}
```

### 4.3 还书

#### 接口说明

**接口功能**

> 归还借阅的图书
>
> - 默认一次性归还所有

**API**

> /bookBorrowReturn/:id

**请求方法**

> PUT

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明         | 必选 | 类型 | 默认值 | 限制 | 备注 |
| :------- | ------------ | :--- | ---- | :----- | ---- | ---- |
| id       | 借还记录的id |      |      |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /bookBorrowReturn/2

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 4.4 删除借阅记录

#### 接口说明

**接口功能**

> 删除借阅记录

**API**

> /bookBorrowReturn/:id

**请求方法**

> DELETE

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明         | 必选 | 类型 | 默认值 | 限制 | 备注 |
| :------- | ------------ | :--- | ---- | :----- | ---- | ---- |
| id       | 借还记录的id |      |      |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /bookBorrowReturn/1

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 5 图书分类管理接口

### 5.1 分页按条件查询所有分类

#### 接口说明

**接口功能**

> 按条件分页查询所有分类

**API**

> ```
> /bookCategory/:curPage/:pageSize?name=
> ```

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明           | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------------- | :--- | ------ | :----- | ---- | ---- |
| curPage  | 当前页数       | 是   | int    | 1      | > 0  |      |
| pageSize | 每页的数据条数 | 是   | int    | 5      |      |      |
| name     | 分类名称       |      | string |        |      |      |

**返回参数说明**

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   | 数据，一个json对象                                  |

**data数据说明**

| 参数    | 说明                   | 类型 | 备注     |
| :------ | ---------------------- | :--- | :------- |
| total   | 查询到的全部数据的条数 | int  |          |
| size    | 每页的数据条数         | int  |          |
| current | 当前的页数             | int  |          |
| pages   | 查询到的全部数据的页数 | int  |          |
| records | 当前页的数据           | json | json数组 |

**records数据说明**

| 参数 | 说明     | 类型   | 备注 |
| :--- | -------- | :----- | :--- |
| id   | 分类id   | int    |      |
| name | 分类名称 | string |      |

#### 接口示例

##### 无条件分页查询所有分类

请求地址

> /bookCategory/1/5?name=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 3,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "计算机"
            },
            {
                "id": 2,
                "name": "数学"
            },
            {
                "id": 3,
                "name": "物理"
            }
        ]
    }
}
```

### 5.2 修改分类

#### 接口说明

**接口功能**

> 修改分类名称

**API**

> /bookCategory

**请求方法**

> PUT

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数 | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------- | :--- | ------ | :----- | ---- | ---- |
| id       | 分类id   | 是   | int    |        |      |      |
| name     | 分类名称 | 是   | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /bookCategory


请求参数

``` json
{
    "id": "1",
    "name": "计算机编程"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 5.3 添加分类

#### 接口说明

**接口功能**

> 添加图书分类

**API**

> /bookCategory/:name

**请求方法**

> POST

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------- | :--- | ------ | :----- | ---- | ---- |
| name     | 分类名称 | 是   | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

##### 添加化学分类

> /bookCategory/化学

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 5.4 删除分类

#### 接口说明

**接口功能**

> 删除一个分类

**API**

> /bookCategory/:id

**请求方法**

> DELETE

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明   | 必选 | 类型 | 默认值 | 限制 | 备注 |
| :------- | ------ | :--- | ---- | :----- | ---- | ---- |
| id       | 分类id | 是   | int  |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

##### 删除计算机分类

> /bookCategory/1

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 6 组织管理接口

### 6.1 分页按条件查询所有组织

#### 接口说明

**接口功能**

> 按条件分页查询所有组织

**API**

> ```
> /organization/:curPage/:pageSize?name=
> ```

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明           | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------------- | :--- | ------ | :----- | ---- | ---- |
| curPage  | 当前页数       | 是   | int    | 1      | > 0  |      |
| pageSize | 每页的数据条数 | 是   | int    | 5      |      |      |
| name     | 组织名称       |      | string |        |      |      |

**返回参数说明**

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   | 数据，一个json对象                                  |

**data数据说明**

| 参数    | 说明                   | 类型 | 备注     |
| :------ | ---------------------- | :--- | :------- |
| total   | 查询到的全部数据的条数 | int  |          |
| size    | 每页的数据条数         | int  |          |
| current | 当前的页数             | int  |          |
| pages   | 查询到的全部数据的页数 | int  |          |
| records | 当前页的数据           | json | json数组 |

**records数据说明**

| 参数 | 说明     | 类型   | 备注 |
| :--- | -------- | :----- | :--- |
| id   | 组织id   | int    |      |
| name | 组织名称 | string |      |

#### 接口示例

##### 无条件分页查询所有组织

请求地址

> /organization/1/5?name=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 1,
                "name": "北京书院"
            },
            {
                "id": 2,
                "name": "北京书院学生会"
            }
        ]
    }
}
```

### 6.2 修改组织

#### 接口说明

**接口功能**

> 修改组织名称

**API**

> /organization

**请求方法**

> PUT

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数 | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------- | :--- | ------ | :----- | ---- | ---- |
| id       | 组织id   | 是   | int    |        |      |      |
| name     | 组织名称 | 是   | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

请求地址

> /organization


请求参数

``` json
{
    "id": "1",
    "name": "北京书院官方"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 6.3 添加组织

#### 接口说明

**接口功能**

> 添加一个组织

**API**

> /organization/:name

**请求方法**

> POST

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明     | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------- | :--- | ------ | :----- | ---- | ---- |
| name     | 组织名称 | 是   | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

##### 添加体育部组织

> /organization/体育部

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

### 6.4 删除组织

#### 接口说明

**接口功能**

> 删除一个组织

**API**

> /organization/:id

**请求方法**

> DELETE

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明   | 必选 | 类型 | 默认值 | 限制 | 备注 |
| :------- | ------ | :--- | ---- | :----- | ---- | ---- |
| id       | 组织id | 是   | int  |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

##### 删除北京书院学生会组织

> /organization/2

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 7 文件上传接口

### 7.1 上传图片

#### 接口说明

**接口功能**

> 上传一张图片

**API**

> /upload

**请求方法**

> POST

**请求参数格式**

> multipart/form-data

**请求参数说明**

| 请求参数 | 说明                         | 必选 | 类型 | 默认值 | 限制                                 | 备注                                                         |
| :------- | ---------------------------- | :--- | ---- | :----- | ------------------------------------ | ------------------------------------------------------------ |
| image    | 上传图片标识的key统一为image | 是   | file |        | <=10MB，格式只能为`jpg/jpeg/png/gif` | 标识图片的key为`image`，不是图片的名称为`image`（参考示例图片） |

**返回参数格式**

> JSON

**返回参数说明**

| 返回参数 | 说明   | 类型   | 备注                                                |
| :------- | ------ | :----- | :-------------------------------------------------- |
| code     | 状态码 | int    | 200表示成功，msg为success，其他状态码则表示请求失败 |
| msg      | 消息   | string | 请求失败时需要消息提示                              |
| data     | 数据   | json   | 图片的url链接                                       |

#### 接口示例

请求地址

> /upload


请求参数

![image-20220207161656343](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202071618194.png)

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": "http://localhost:8080/63ee881b-1e59-4fee-9642-61f83f275191.png"
}
```

## 8 注册接口

#### 数据库说明

- 成功提交的注册信息存储在`register`表中，表结构如下

  ![image-20220208170918824](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081709879.png)

  ![image-20220208171044882](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081710941.png)



  ![image-20220208171333518](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202081714379.png)

- 字段说明

- | 字段            | 说明                      | 类型     |
  | :-------------- | ------------------------- | -------- |
  | id              | 主键id                    | int      |
  | account         | 账号                      | string   |
  | username        | 用户名                    | string   |
  | password        | 密码                      | string   |
  | register_time   | 申请注册的时间            | datetime |
  | process_time    | 处理申请的时间            | datetime |
  | rejected        | 是否拒绝申请，1表示已拒绝 | int      |
  | passed          | 是否通过申请，1表示已通过 | int      |
  | is_admin        | 是否是管理员，1表示是     | int      |
  | process_user_id | 处理人的id                | int      |

### 8.1 申请注册

#### 接口说明

**接口功能**

> 用户注册
>
> - 用户成功提交注册信息后，需要管理员审核，审核通过后才可以登录
> - 若管理员审核不通过，则表示注册失败，后续也无法登录

**说明**

> 1. 申请注册时，前端需要保证数据不为空，校验数据长度是否合法，`password`需要转换为md5加密32位小写
> 2. 后端拿到数据后，也需要校验数据是否为空，长度是否合法，校验密码长度是否为32
> 3. 后端需要再进一步校验账号和用户名是否已存在，校验范围为`sys_user`表中的账号和用户名，`register`表中还未处理的申请（即`rejected==0 && passed==0`）

**API**

> /register

**请求方法**

> POST

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数 | 说明                  | 必选 | 类型   | 默认值 | 限制   | 备注 |
| :------- | --------------------- | :--- | ------ | :----- | ------ | ---- |
| account  | 账号                  | 是   | string |        | 6-16位 |      |
| username | 用户名                | 是   | string |        | 1-10位 |      |
| password | 密码                  | 是   | string |        | 6-16位 |      |
| is_admin | 是否是管理员，1表示是 |      | int    | 0      | 1或0   |      |

**返回参数格式**

> JSON

**返回参数说明**

> 返回200表示提交注册信息成功

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

#### 示例

##### 申请注册成功

请求地址

> /register


请求参数

``` json
{
    "account": "1320219009",
    "username": "注册用户1",
    "password": "6c76860b2b83d21905d2d264d26ab8dd",
    "is_admin": "0"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

##### 注册失败账号重复

请求地址

> /register


请求参数

``` json
{
    "account": "1320219001",
    "username": "注册用户1",
    "password": "38a644eb14c7893f8d999fede5863ee2",
    "is_admin": "0"
}
```

返回参数（`xxx`写代码时自定义即可）

```json
{
    "code": "xxx",
    "msg": "账号已存在",
    "data": null
}
```

##### 注册失败用户名重复

请求地址

> /register


请求参数

``` json
{
    "account": "1320219009",
    "username": "北京书院",
    "password": "6c76860b2b83d21905d2d264d26ab8dd",
    "is_admin": "0"
}
```

返回参数（`xxx`写代码时自定义即可）

```json
{
    "code": "xxx",
    "msg": "用户名已存在",
    "data": null
}
```

### 8.2 查询注册信息

#### 接口说明

**接口功能**

> 分页查询注册信息
>
> - 管理员查询注册信息，并处理

**API**

> /register/:curPage/:pageSize?rejected=&passed=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明         | 必选 | 类型 | 默认值   | 限制 | 备注 |
| :------- | ------------ | :--- | ---- | :------- | ---- | ---- |
| curPage  | 当前页数     | 是   | int  | 1        |      |      |
| pageSize | 每页的数据量 | 是   | int  | 5        |      |      |
| rejected | 是否已拒绝   |      | int  | 0或1或空 |      |      |
| passed   | 是否已通过   |      | int  | 0或1或空 |      |      |

> 备注：
>
> - `rejected=0&passed=0`：表示未处理的申请
> - `rejected=1&passed=0`：表示已拒绝的申请
> - `rejected=0&passed=1`：表示已通过的申请
> - `rejected=&passed=`：条件都为空表示查询所有的记录
> - `rejected`和`passed`不可同时为`1`，若同时为`1`理论上查询不到任何数据，但后端应该返回`参数错误`的查询失败信息
> - 后端查询数据库时，需要首先判断两个条件是否同时为`1`，若是则直接返回错误信息，若条件为空则不需要携带该条件

**返回参数格式**

> JSON

**返回参数说明**

> 备注：
>
> - 该接口是分页查询，分页查询具体的返回参数结构参考`2.1 查询图书`，以下参数说明为`records`数组中每一个对象的参数
> - 查询时按照申请注册的时间降序排列，即新的注册信息在前面
> - 查询页数超过最大页数返回最后一页

> 注意：不需要返回密码

| 返回参数          | 说明                           | 类型          | 备注 |
| :---------------- | ------------------------------ | :------------ | :--- |
| id                | 主键id                         | int           |      |
| account           | 账号                           | string        |      |
| username          | 用户名                         | string        |      |
| is_admin          | 是否管理员，1是0否             | int           |      |
| rejected          | 是否已拒绝，1是0否             | int           |      |
| passed            | 是否已通过，1是0否             | int           |      |
| register_time     | 申请注册的时间                 | datetime      |      |
| process_time      | 处理的时间，如果还未处理则为空 | datetime/null |      |
| process_user_name | 处理人的name                   | string        |      |

#### 接口示例

##### 查询所有申请记录第1页

请求地址

> /register/1/5?rejected=&passed=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 6,
        "size": 5,
        "current": 1,
        "pages": 2,
        "records": [
            {
                "id": 6,
                "account": "1320219008",
                "username": "测试用户3",
                "is_admin": 0,
                "rejected": 0,
                "passed": 0,
                "register_time": "2022-02-08 17:13:02",
                "process_time": "",
                "process_user_name": ""

            },
            {
                "id": 5,
                "account": "1320219007",
                "username": "测试管理员3",
                "is_admin": 0,
                "rejected": 0,
                "passed": 0,
                "register_time": "2022-02-08 17:12:33",
                "process_time": "",
                "process_user_name": ""

            },
            {
                "id": 4,
                "account": "1320219006",
                "username": "测试管理员2",
                "is_admin": 0,
                "rejected": 0,
                "passed": 1,
                "register_time": "2022-02-05 17:30:57",
                "process_time": "2022-02-05 17:34:08",
                "process_user_name": "北京书院"

            },
            {
                "id": 3,
                "account": "1320219005",
                "username": "测试管理员1",
                "is_admin": 0,
                "rejected": 1,
                "passed": 0,
                "register_time": "2022-02-05 17:30:29",
                "process_time": "2022-02-05 17:34:04",
                "process_user_name": "北京书院"

            },
            {
                "id": 2,
                "account": "1320219004",
                "username": "测试用户2",
                "is_admin": 0,
                "rejected": 0,
                "passed": 1,
                "register_time": "2022-02-05 17:30:02",
                "process_time": "2022-02-05 17:33:51",
                "process_user_name": "北京书院"

            }
        ]
    }
}
```

##### 查询所有申请记录第2页

请求地址

> /register/2/5?rejected=&passed=

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 6,
        "size": 5,
        "current": 2,
        "pages": 2,
        "records": [
            {
                "id": 1,
                "account": "1320219003",
                "username": "测试用户1",
                "is_admin": 0,
                "rejected": 1,
                "passed": 0,
                "register_time": "2022-02-05 17:26:49",
                "process_time": "2022-02-05 17:31:20",
                "process_user_name": "北京书院"

            }
        ]
    }
}
```

##### 查询已拒绝的注册信息

请求地址

> /register/1/5?rejected=1&passed=0

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 3,
                "account": "1320219005",
                "username": "测试管理员1",
                "is_admin": 0,
                "rejected": 1,
                "passed": 0,
                "register_time": "2022-02-05 17:30:29",
                "process_time": "2022-02-05 17:34:04",
                "process_user_name": "北京书院"

            },
            {
                "id": 1,
                "account": "1320219003",
                "username": "测试用户1",
                "is_admin": 0,
                "rejected": 1,
                "passed": 0,
                "register_time": "2022-02-05 17:26:49",
                "process_time": "2022-02-05 17:31:20",
                "process_user_name": "北京书院"

            }
        ]
    }
}
```

##### 查询已通过的注册信息

请求地址

> /register/1/5?rejected=0&passed=1

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 4,
                "account": "1320219006",
                "username": "测试管理员2",
                "is_admin": 0,
                "rejected": 0,
                "passed": 1,
                "register_time": "2022-02-05 17:30:57",
                "process_time": "2022-02-05 17:34:08",
                "process_user_name": "北京书院"

            },
            {
                "id": 2,
                "account": "1320219004",
                "username": "测试用户2",
                "is_admin": 0,
                "rejected": 0,
                "passed": 1,
                "register_time": "2022-02-05 17:30:02",
                "process_time": "2022-02-05 17:33:51",
                "process_user_name": "北京书院"

            }
        ]
    }
}
```

##### 查询未处理的注册信息

请求地址

> /register/1/5?rejected=0&passed=0

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "total": 2,
        "size": 5,
        "current": 1,
        "pages": 1,
        "records": [
            {
                "id": 6,
                "account": "1320219008",
                "username": "测试用户3",
                "is_admin": 0,
                "rejected": 0,
                "passed": 0,
                "register_time": "2022-02-08 17:13:02",
                "process_time": "",
                "process_user_name": ""

            },
            {
                "id": 5,
                "account": "1320219007",
                "username": "测试管理员3",
                "is_admin": 0,
                "rejected": 0,
                "passed": 0,
                "register_time": "2022-02-08 17:12:33",
                "process_time": "",
                "process_user_name": ""

            }
        ]
    }
}
```

### 8.3 处理注册信息

#### 接口说明

**接口功能**

> 管理员处理注册信息，通过或拒绝

**API**

> /register

**请求方法**

> PUT

**请求参数格式**

> JSON

**请求参数说明**

| 请求参数  | 说明                             | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :-------- | -------------------------------- | :--- | ------ | :----- | ---- | ---- |
| id        | 申请记录的id                     | 是   | int    |        |      |      |
| operation | 操作，`pass`通过，`rejected`拒绝 | 是   | string |        |      |      |

**返回参数格式**

> JSON

#### 接口示例

##### 通过申请

请求地址

> /register


请求参数

``` json
{
    "id": 5,
    "operation": "passed"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

##### 拒绝申请

请求地址

> /register


请求参数

``` json
{
    "id": 6,
    "operation": "rejected"
}
```

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": null
}
```

## 9 数据统计接口

> 备注：此接口需要新建控制层，业务层、映射层的类
>
> 类的前缀统一为`BookStatistic`，如`BookStatisticController.java`

### 9.1 查询网站的访问人数

#### 数据库说明

1. 统计网站的访问人数使用的方法是记录ip，也就是说一个ip就算一个访问数，同一个ip多次访问也只算一个访问数
2. 表结构如下
   ![image-20220209220205546](https://gitee.com/BIT_Worker/pic-go/raw/master/img/202202092202603.png)
3. 获取访问总数即统计该表的记录数即可（`select count(*)`），该表使用的引擎是`myisam`，这种引擎会存储表总共有多少条记录，所以查询总记录数是很快的

#### 接口说明

**接口功能**

> 查询网站的访问人数

**API**

> /bookStaStatistic/totalViews

**请求方法**

> GET

**返回参数格式**

> JSON

**返回参数说明**

> 返回的json数据中`data`就是访问人数

#### 接口示例

##### 查询网站的访问人数

请求地址

> /bookStaStatistic/totalViews

返回参数

```json
{
    "code": 200,
    "msg": "success",
    "data": 123
}
```

### 9.2 按年查询入库记录

#### 接口说明

**接口功能**

> 按年查询入库记录
>
> - 数据中包含了全年的总数和每个月的总数

**API**

> /bookStaStatistic/entry?year=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明           | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------------- | :--- | ------ | :----- | ---- | ---- |
| year     | 年份（`yyyy`） | 是   | string |        |      |      |

**返回参数格式**

> JSON

**返回参数说明**

> 具体结合示例查看

| 返回参数     | 说明              | 类型     | 备注 |
| :----------- | ----------------- | :------- | :--- |
| totalType    | 该年类型总数      | int      |      |
| totalNumber  | 该月数量总数      | int      |      |
| monthRecords | 所有月的记录      | json数组 |      |
| month        | 月份（`yyyy-MM`） | string   |      |
| type         | 该月份种类数量    | int      |      |
| number       | 该月份数量        | int      |      |

**备注**

> `type`种类的数量对应于数据库中图书分类`category`的数量

#### 接口示例

##### 查询2022年的入库数据统计

请求地址

> /bookStaStatistic/entry?year=2022

返回参数

> - 具体数据以后端从数据库中查询出的数据为准
> - 查出了几个月的数据就返回几个月

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "totalType": 7,
        "totalNumber": 40,
        "monthRecords": [
            {
                "month": "2022-01",
                "type": 2,
                "number": 15
            },
            {
                "month": "2022-02",
                "type": 5,
                "number": 25
            }
        ]
    }
}
```

### 9.3 按月查询入库记录

#### 接口说明

**接口功能**

> 按月查询入库记录
>
> - 数据中包含了该月的总数和每天的总数

**API**

> /bookStaStatistic/entry?month=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明              | 必选 | 类型   | 默认值 | 限制 | 备注                    |
| :------- | ----------------- | :--- | ------ | :----- | ---- | ----------------------- |
| month    | 年份（`yyyy-MM`） | 是   | string |        |      | 年+月，不可只传递月份数 |

**返回参数格式**

> JSON

**返回参数说明**

> 具体结合示例查看

| 返回参数    | 说明                     | 类型     | 备注     |
| :---------- | ------------------------ | :------- | :------- |
| totalType   | 该月类型总数             | int      |          |
| totalNumber | 该月数量总数             | int      |          |
| dayRecords  | 每天的记录               | json数组 |          |
| day         | 天数日期（`yyyy-MM`-dd） | string   | 年+月+日 |
| type        | 该天种类数量             | int      |          |
| number      | 该天数量                 | int      |          |

**备注**

> `type`种类的数量对应于数据库中图书分类`category`的数量

#### 接口示例

##### 查询2022年1月的入库数据统计

请求地址

> /bookStaStatistic/entry?month=2022-01

返回参数

> - 具体数据以后端从数据库中查询出的数据为准
> - 查出了几天的数据就返回几天

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "totalType": 7,
        "totalNumber": 40,
        "dayRecords": [
            {
                "day": "2022-01-01",
                "type": 2,
                "number": 15
            },
            {
                "day": "2022-01-02",
                "type": 5,
                "number": 25
            }
        ]
    }
}
```

### 9.4 按年查询借出记录

#### 接口说明

**接口功能**

> 按年查询借出记录
>
> - 数据中包含该年的总数和每个月的数量
> - 查询条件要携带年份，格式为`yyyy`

**API**

> /bookStaStatistic/borrow?year=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明           | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | -------------- | :--- | ------ | :----- | ---- | ---- |
| year     | 年份（`yyyy`） | 是   | string |        |      |      |

**返回参数格式**

> JSON

**返回参数说明**

> 参考`9.2` `9.3`

**备注**

> `type`种类的数量对应于数据库中图书分类`category`的数量

#### 接口示例

##### 查询2022年的借出数据统计

请求地址

> /bookStaStatistic/borrow?year=2022

返回参数

> - 具体数据以后端从数据库中查询出的数据为准
> - 查出了几个月的数据就返回几个月

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "totalType": 7,
        "totalNumber": 40,
        "monthRecords": [
            {
                "month": "2022-01",
                "type": 2,
                "number": 15
            },
            {
                "month": "2022-02",
                "type": 5,
                "number": 25
            }
        ]
    }
}
```

### 9.5 按月查询借出记录

#### 接口说明

**接口功能**

> 按月查询借出记录
>
> - 数据中包含该月的总数和每天的数量
> - 查询条件要携带年份，格式为`yyyy-MM`

**API**

> /bookStaStatistic/borrow?month=

**请求方法**

> GET

**请求参数格式**

> URL路径变量

**请求参数说明**

| 请求参数 | 说明             | 必选 | 类型   | 默认值 | 限制 | 备注 |
| :------- | ---------------- | :--- | ------ | :----- | ---- | ---- |
| month    | 年+月（yyyy-MM） | 是   | string |        |      |      |

**返回参数格式**

> JSON

**返回参数说明**

> 参考`9.2` `9.3`

**备注**

> `type`种类的数量对应于数据库中图书分类`category`的数量

#### 接口示例

##### 查询2022年1月的入库和借出数据统计

请求地址

> /bookStaStatistic/borrow?month=2022-01

返回参数

> - 具体数据以后端从数据库中查询出的数据为准
> - 查出了几天的数据就返回几天

```json
{
    "code": 200,
    "msg": "success",
    "data": {
        "totalType": 7,
        "totalNumber": 40,
        "dayRecords": [
            {
                "day": "2022-01-01",
                "type": 2,
                "number": 15
            },
            {
                "day": "2022-01-02",
                "type": 5,
                "number": 25
            }
        ]
    }
}
```

### 
